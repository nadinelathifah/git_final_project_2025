{% extends "layout.html" %}
{% block body_content %}

<section id="find-tp">
    <div class="">
        <div class="outer-wrapper">
            <div class="col-md-6 column-left">
                <div class="card find-card">
                    <form method="POST" action="{{ url_for('find_tradesperson') }}#results">
                        <div class="mb-3 select-wrapper">
                            <label class="form-label"><span class="material-symbols-outlined search">handyman</span><h4>What task do you need helping with?</h4></label>
                            <select name="task" class="select-inner">
                                <option value="">Any</option>
                                {% for task in tasks %}
                                <option value="{{ task[0] }}">{{ task[0] }}</option>
                                {% endfor %}
                            </select>
                            <span class="material-symbols-rounded drop-arrow">expand_circle_down</span>
                        </div>
            
                        <div class="mb-3 select-wrapper">
                            <label class="form-label"><span class="material-symbols-outlined search">home_pin</span><h4>Which location?</h4></label>
                            <select name="location" class="select-inner">
                                <option value="">Any</option>
                                {% for town in towns %}
                                <option value="{{ town[0] }}">{{ town[0] }}</option>
                                {% endfor %}
                            </select>
                            <span class="material-symbols-rounded drop-arrow">expand_circle_down</span>
                        </div>
            
                        <div class="mb-3 select-wrapper">
                            <label class="form-label"><h4><i class='bx bx-pound bx-border-circle'></i>Hourly rate:</h4></label>
                            <select name="hourly_rate" class="select-inner">
                                <option value="">No Preference</option>
                                <option value="ASC">Lowest to Highest</option>
                                <option value="DESC">Highest to Lowest</option>
                            </select>
                            <span class="material-symbols-rounded drop-arrow">expand_circle_down</span>
                        </div>
            
                        <div class="mb-3 select-wrapper">
                            <label class="form-label"><h4><i class='bx bx-star bx-border-circle'></i>Rating:</h4></label>
                            <select name="star_rating" class="select-inner">
                                <option value="">No Preference</option>
                                <option value="ASC">Lowest to Highest</option>
                                <option value="DESC">Highest to Lowest</option>
                            </select>
                            <span class="material-symbols-rounded drop-arrow">expand_circle_down</span>
                        </div>
            
                        <button type="submit" id="find-btn" class="btn btn-primary btn-block">Find My Tradesperson</button>
                    </form>
                </div>
            </div>

            <div class="col-md-6 column-right">
                <img class="find-img img-1" src="{{ url_for('static', filename='decoration/lightblue.png')}}" alt="">
                <img class="find-img img-2" src="{{ url_for('static', filename='decoration/circle_orange.png')}}" alt="">
                <img class="find-img img-3" src="{{ url_for('static', filename='images/handywoman.png')}}" alt="">
                <img class="find-img img-4" src="{{ url_for('static', filename='images/handywoman2.png')}}" alt="">
            </div>
        </div>
        {% if results %}
        <div class="container pt-5">
            <hr>
            <h2 id="results" class="my-4"><i class='bx bx-rocket bx-border-circle one'></i>Choose your hero<i class='bx bx-rocket bx-border-circle two'></i></h2>
            <hr>
            <div class="row row-cols-1 row-cols-md-2 g-4">
            {% for r in results %}
                <div class="col">
                    <div id="find-card" data-aos="fade-up" class="card h-100 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">{{ r.full_name }} <span class="material-symbols-outlined .verified">verified_user</span></h5>
                            <p class="card-text">
                                <strong>Task:</strong> {{ r.task_name }}<br>
                                <strong>Town:</strong> {{ r.town }}<br>
                                <strong>Rate:</strong> Â£{{ r.hourly_rate }}<br>
                                <strong>Rating:</strong> {{ r.average_rating or 'N/A' }} ({{ r.total_reviews }} reviews)<br>
                                <strong>Bio:</strong> {{ r.bio }}
                            </p>
                            <form action="{{ url_for('book_service') }}" method="POST">
                                <input type="hidden" name="worker_id" value="{{ r.workerID }}">
                                <input type="hidden" name="task_id" value="{{ r.taskID }}">
                                <input type="hidden" name="town_id" value="{{ r.townID }}">
                                <button type="submit" id="book-btn" class="btn btn-primary">Book This Tradesperson</button>
                            </form>
                        </div>
                    </div>
                </div>
            {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    <br>
</section>

{% endblock %}
